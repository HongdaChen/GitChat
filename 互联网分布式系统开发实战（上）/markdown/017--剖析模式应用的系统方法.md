从今天开始我们将进入本课程的第二大模块的介绍，即《剖析框架中的架构模式与设计模式》。架构模式和设计模式所涵盖的内容非常广泛，我们无意对所有的模式进行展开，而是围绕
Dubbo 和 Mybatis 这两个主流框架，深度剖析这些框架中所用到的典型的架构模式和设计模式。

关于模式（Pattern）这个词，业界也并没有给出非常统一的定义。因此，作为整个模块的开篇，我们有必要讨论一下模式的基本概念，并给出我们的思路。

### 关于模式的基本概念

在经典的 POSA（Pattern-Oriented Software
Architecture，面向模式的软件架构）系列图书的第一卷中提到，根据问题的规模或抽象层次可以将软件设计模式分成三个层次，即架构模式（Architecture
Pattern）、设计模式（Design
Pattern）和习惯用法（Idiom）。其中架构模式是一种高层模式，用于描述系统级的结构组成、相互关系及相关约束。对架构模式的选择是最基本的设计决策，将决定系统的基本架构以及后续的设计及开发活动。

而设计模式是中层模式，是针对系统局部设计问题给出的解决方案。设计模通常式的选择对系统的基本架构没有影响，但在实现架构模式时，则可能采用多种设计模式。架构模式和设计模式被认为是与具体编程语言和工具无关的，而习惯用法则被认为是一种与具体实现方式相关的低层模式。习惯用法给出的解决方案通常与具体编程语言的某种语法机制相关。

另一方面，讲到架构模式，我们也需要理解它与架构风格（Architecture Style）之间的区别。

架构模式基于子系统或模块及其之间的关系层次，描述了架构粗粒度的解决方案，着重描述系统的内部组织。架构风格描述的是系统组织方式的惯用方式，是系统组织性的设计，可以认为风格是模式的外在表现。架构模式的切入点在于找到系统中某一个结构需求并提供内部组织的抽象。

虽然架构模式和架构风格在概念上有所不同，但在有些场景下往往并不容易也没有必要严格区分所使用的设计结构究竟是架构风格还是架构模式，正如我们在开发 Web
应用程序时提到的 MVC 风格，很多时候也可以被认为是一种架构模式。

同时，较之架构风格，架构模式数量众多，本书也不会对所有的架构模式面面俱到，而是侧重介绍对于一个软件系统而言通常都会涉及到的架构模式，并通过具体应用场景分析来给出这些架构模式更深层次的理解。

但架构模式与设计模式还是有本质性的区别。虽然两种模式都在于提供一套可重用的设计的方法，但二者具有不同的粒度，相较架构模式，设计模式更偏重于定义出某个功能组件的微观结构。

假如我们把 MVC
视为一种架构模式，该模式给出了一种交互式系统的架构设计，主要思想是实现业务逻辑和用户界面之间的分离。而为了实现这一设计理念，可以会采用一些常见的设计模式。例如，下图展示了
MVC 模式中各个组件的交互过程。如果我们想要把 Model 层的变化通知到 View 层，则可以使用观察者模式来实现这一目标。

同样，如果我们想要根据用户操作来更新具体的模型，则又可以采用策略模式。而 View 层的各种视图则可能基于组合模式进行管理。这样，一个 MVC
架构模式在实现上可能需要使用的主要设计模式就包括观察者模式、组合模式和策略模式等多种设计模式。

![17.01](https://images.gitbook.cn/2020-05-25-052648.png)

### 架构模式：把握框架设计思想

我们为什么要学习架构模式？是因为需要把握框架的设计思想。

请看如下所示的设计层次图。对于一个软件系统的设计工作而言，我们需要打造上图中的三个核心库，即领域模型库、体系结构库和可复用设计库，从而完成从需求分析→高层设计→底层设计的设计闭环。对于需求分析阶段而言，我们关注于建设特定应用领域的领域模型，在当下微服务架构成为主流架构设计体系的背景下，通常使用领域驱动设计（Domain
Driven Design，DDD）来完成这领域模型库的建设。这部分内容不是本课程的重点，不做展开。

![17.02](https://images.gitbook.cn/2020-05-25-052649.png)

对于上图中的高层设计而言，我们的手段是使用特定应用领域的体系结构。不同于业务领域，对于开源框架而言，这里的特定领域是指远程调用、数据访问等技术领域。源码解读的一大切入点就是基于这些技术领域梳理和提炼针对高层设计的架构模式。我们需要通过业界主流的架构模式来建设对自己对体系结构上的理解和认识。

业界存在的架构模式非常之多， POSA 对其进行了系统化的分类。根据 POSA
中的描述，架构模式一般可以从基线架构、分布式基础设施、事件分离和分发、接口划分、组件划分、应用控制、并发和同步、适配与扩展、资源管理等维度进行划分。

本课程无意对这些模式做全面和详细的介绍，而是结合 Dubbo 和 Mybatis
等框架，只挑选最具代表性的几个架构模式进行分析并介绍它们在不同场景下的应用。通过远程过程调用、数据访问等特定领域理解如何构建高扩展性、高灵活性的框架结构。

### 设计模式：分析代码类层关系

我们为什么要学习设计模式？是因为需要分析框架代码中的类层关系。

回顾前面提到的设计层次图，在底层设计环节，我们关注于使用可复用的设计模式和对象，这就是设计模式的作用。软件设计开发中使用设计模式的主要目标是通过再次使用已经获得的设计经验提高系统的灵活性。大部分系统中都会或多或少包含一些设计模式，很多时候实现同一个功能会有很多不同的方式，但使用设计模式往往能够提供更为优雅的实现方式。

业界存在的设计模式同样很多。依据设计模式的行为方式，也即其目的，我们可以将设计模式分为三种类型，分别是创建型模式、结构型模式和行为型模式。这三种类型下包含的设计模式常见的有
23 种，本课程无意对这些设计模式的定义和结构做过多展开，经典著作《设计模式：可复用面向对象软件的基础》对这些设计模式进行了很好的阐述。

掌握设计模式的难度在于每个模式看上去都能够理解但就是不知道如何应用，固然在日常开发过程中多尝试应用设计模式有助于提高自身的设计能力，但通过阅读源代码的方式来加深对设计模式的理解和掌握是一条捷径。

### 面试题分析

#### 架构模式与设计模式的区别和联系是什么？

  * 考点分析

这个问题偏理论，在"架构"一词被滥用的背景下，有些面试环节会聊聊这种偏开放性的话题。从考点上，还是主要考查面试者对这种容易混淆或者说比较难以表述清楚的话题的敏感性，以及综合的表述能力。

  * 解题思路

设计模式我们比较常见，也有经典的著作可以直接做参考。但架构模式实际上也是非常大的一个知识体系，相较于设计模式面向底层设计，架构模式更加关注于高层次的设计。两者之间的区别和联系可以通过一些示例进行阐述，例如本文通过常见的
MVC 架构模式做了分析，这个示例可以很好的回答这个问题。

  * 本文内容与建议回答

本文从内容上对构模式与设计模式的区别和联系已经做了全面的介绍，从知识体系角度讲完全可以应对这个问题。但是，纯理论的阐述往往比较枯燥，也缺乏说服力，因此，本文同样给出了
MVC 这一架构模式，提到该架构模式的背后实际上也依赖于观察者模式、组合模式和策略模式等多种设计模式。

### 小结与预告

从本文开始，我们将开始剖析框架中的架构模式与设计模式。我们将先从最具代表性的架构模式开始，这一模式就是在开源框架领域应用非常广泛的微内核架构模式，下一篇我们将先给出微内核模式的基本概念以及基于
Java SPI 机制的实现方式。

