这天，BOSS 来到我的座位旁，我一瞅，和颜悦色笑脸相迎的准没好事。果然，是带着问题和任务过来的。

原来，地鼠商城在某个页面新增了一个精选场景，一开始上线时，日活（每日活跃用户）和点击率都比较稳定的增长，但是半个月之后不但不再增长，反而有下降的趋势，于是
BOSS 就希望我能够找出问题并解决它。

> 一般新业务的初期，都会以点击率为商业指标，因为这个阶段主要是为了拉新和留存。当业务发展的比较成熟时（比如日活持续 N 天保持稳定或者增长等），再以
> GMV 为商业指标，这个阶段考虑变现。

经过日以继夜的数据分析和模型 Debug，发现了以下几个问题：

  * 15 天内曝光物品的总数大概是在售物品的 1/10
  * 活跃用户的点击率远高于非活跃用户（活跃用户定义为 15 天内点击次数大于 N 的用户）
  * 非活跃用户占总用户数的 70%
  * 非活跃用户的推荐结果几乎不会发生变化且比较随机
  * ......

这确实落入了一个我们迄今为止都没有提及但是在推荐系统中又不得不面对的问题——冷启动。

### 什么是冷启动

所谓的冷启动问题，引用[维基百科的定义](https://en.wikipedia.org/wiki/Cold_start_\(recommender_systems\))

> Cold start is a potential problem in computer-based information systems
> which involves a degree of automated data modelling. Specifically, it
> concerns the issue that the system cannot draw any inferences for users or
> items about which it has not yet gathered sufficient information.

中心思想是推荐系统对于新用户或者新物品了解的还不够多，没有办法掌握新用户的喜好，所以也就不能很好的为这类用户提供很好的推荐服务。同理，推荐系统对新物品也几乎一无所知，它的销量、点击率、转化率等等信息全都未知。

以具体算法为例，大家还记得协同过滤的原理吗？协同过滤需要用户有历史行为，同时也需要物品被用户消费过，最后不管是计算用户与用户之间的相似度，还是物品与物品之间的相似度，对于新用户或者新物品，该算法都是束手无策的。

同样的问题也发生在关联规则和 Word2Vec
中，几乎所有的算法（包括深度学习算法）在冷启动的问题上都显得捉襟见肘，因为算法依赖数据，对于从未出现过的用户或者物品，如果不施加一定的人工策略，很难有较好的收益。要知道大部分的推荐系统，长尾现象都特别明显，一旦冷启动问题处理不好，会造成很强的马太效应，导致推荐系统越推越窄，流动性越来越差，用户看到的物品越来越局限、最终可能会使推荐系统丧失它的作用。

> 长尾现象是说少数活跃的用户或者物品提供了多数的样本，类似二八定律，比如 20% 的物品提供了 80% 的销量。
>
> 马太效应是说强者愈强、弱者愈弱。越热门的物品越受人欢迎、越冷门的物品越无人问津。

因为冷启动问题至关重要，所有它是每个推荐系统都必须要考虑的问题，对于它的处理一直在演进中，笔者在这里给出一些常用的处理手法，希望能对读者在实际应用中处理此类问题时有所帮助。

### 用户冷启动

当一个新用户来到推荐系统，TA
的用户属性（性别、年龄等）、行为偏好（热衷数码产品、小说达人或者偏爱蓝色等等）等等信息一概不知。虽然此时协同过滤、关联规则等等算法全都失效，我们依然可以给
TA 做出一定程度的个性化推荐结果。

什么样的用户被定义为冷启动用户呢？根据各自的业务不同，定义也会不同。比如定义从未购买过的用户为冷启动用户等等。

#### **热门榜**

热门榜应该是最先考虑到的冷启动解决方案，实现简单，通常来说也不会有太大问题，对于一个新用户，给 TA
展示销量高（点击高等等）的物品总不至于犯大错吧。不过，就算是热门排行榜，也要讲究一些策略。

#### **朴素热门榜**

这也是热门榜最简单的一种形式，直接计算所有物品在最近一段时间内某个维度的统计值，按照降序排序取 topN，存储到数据库/内存中，只要判断是冷启动用户就推这个
N 个物品。

> 维度：根据领域的不同，维度也会不一样，电商中一般有销量、加车数、收藏数、点击数等等。

不过这种策略的缺点也很明显，如果时间范围取的过长，则可能会造成 topN
物品很长一段时间内都不会发生变化，同时如果维度只选择一种（比如只按照销量排序），则也可能会造成同样的问题，一旦冷启动用户若干次看到同样的结果，则会对推荐系统产生厌倦感，很大程度上会造成冷启动用户的流失。

#### **综合排序热门榜**

使用过电商 APP
的读者应该对“综合排序”不陌生，在搜索物品时，可以选择“价格排序”、“销量排序”以及“综合排序”，那么这个“综合排序”的概念我们也可以引入到冷启动策略中来。

为了解决上述朴素热门榜的两个问题：

  1. 维度单一
  2. 物品流动性不够（指 topN 物品很长一段时间内不会发生变化）

我们可以按照如下维度来做物品的综合排序：

  1. 销量
  2. 加车量
  3. 收藏量
  4. 点击量
  5. 评论数
  6. 转化率
  7. 点击率
  8. 好评率
  9. **上架时长**

当然这里只是列举出了常用的一些维度，读者们可以按照自己的业务需求添加不同的统计维度。可以看出，综合考虑这 9 个维度可以解决 **维度单一** 的问题，
**上架时长** 的加入可以解决 **物品流动性不够** 的问题。

我们的最终目标是使用上述 9 个维度的数据来对每个物品打分，再根据打分取 topN 的物品，所以希望有如下公式：

$$\begin{align}score_{物品} = w_{销量} \times 销量 + w_{加车量} \times 加车量 + w_{收藏量}
\times 收藏量 + w_{点击量} \times 点击量 + w_{评论数} \times 评论数 + \\\w_{转化率} \times 转化率 +
w_{点击率} \times 点击率 + w_{好评率} \times 好评率 + \\\w_{上架时长} \times 上架时长\end{align}$$

眼光锐利的读者可能一下子就发现了这个公式的问题：是的，各维度数据的取值范围不一致，部分需要做归一化，将取值限定在 [0,
1]。归一化的方式有许多种，这里就简单给一种作为示例。

以 **销量** 为例：

  1. 计算每个物品的销量 $S_i$
  2. 计算 95 百分位的销量值，假设为 $S_{p_{95}}$
  3. 按如下公式归一化

$$S_i = \begin{equation} \left\\{ \begin{array}{**lr**}
\frac{S_i}{S_{p_{95}}}, & S_i < S_{p_{95}} \\\ 1, &otherwise \end{array}
\right. \end{equation}$$

按照同样的逻辑，可以完成对加车量、收藏量等绝对数值的归一化处理。转化率、点击率等数据本身已经在 [0, 1] 之内了，所以可以不用再做处理。

至于 **上架时长** ，设置这一维度，是为了能够让新品有机会被推出来，所以一般情况下可以这么处理（假设上架 15 天后被定义为老品）：

$$normalized_{上架时长}= \begin{equation} \left\\{ \begin{array}{**lr**}
1-\frac{上架天数}{15}, & 上架天数 < 15 \\\ 0, &otherwise \end{array} \right.
\end{equation}$$

上述过程就完成了 9 个维度的归一化处理，将归一化后的值加权求和就可以得到最终每个物品的打分。

> 权重一般可以根据业务场景中各个维度的重要性来人为指定。

这种综合排序的方式对于处理用户冷启动问题是比较友好的。还在被此问题困扰的读者，不妨可以尝试一下这种方式，说不定有意想不到的效果。

#### **其他**

还有一些比较常用的方法在此也简单介绍下：

  1. 利用用户的注册信息、设备信息、地址位置等去做推荐：比如 同一个手机型号 + 同一个城市 的热门榜 等等。
  2. 显示用户偏好：显示的让用户选择感兴趣的类别，比如数码、游戏之类的，然后利用用户选择的具体类别去做推荐。这种方式带有一定的强迫性，可能会给用户带去不好的体验。
  3. 外站信息：这里稍微提一下，有的公司之间会有数据共享，比如用户在 A 公司网站/App 上的行为，B 公司可以拿到，从而有效解决 B 公司的用户冷启动的问题，尤其是当 A 公司用户基数特别大、用户行为特别丰富时，这种优势就更为明显了。

### 物品冷启动

当新品上市时，其在模型的训练数据中可以认为是不存在的，这也就导致了单纯想要通过模型将其推出来是非常困难的，必须采取一定的策略。而且在前面我们也提到过，物品冷启动的问题如果处理的不好，最严重的后果是导致推荐系统失去作用。

与冷启动用户一样，冷启动物品的定义也是取决于各自的业务场景，比如上架 3 天内或者购买次数不超过 3 件的物品。

#### **冷热召回**

所谓的冷热召回，是指在召回阶段，兵分两路，一路从非冷启动物品中召回、一路从冷启动物品中召回，如下图所示：

![](https://images.gitbook.cn/a5b066e0-a1a1-11eb-8d7d-61d3e9c8e4b1)

采用这种方式的好处是肯定可以把冷启动物品召出来，这是第一步。至于召出的冷启动物品相关性以及质量则可以通过以下策略来保证。

#### **物品元数据**

新上的物品，基本上都有其元数据（meta data），比如标题、描述、品牌、分类等等信息，我们可以好好的利用这些元数据。

**1\. 物品相似性**

既然有了物品的元数据，那么就可以据此计算物品与物品之间的相似度，一旦有了这个相似关系，利用用户历史行为，推荐与历史行为相似度比较高的冷启动物品就再容易不过了。

常用的 TF-IDF 便可完成此任务，但是我们有更好的武器——深度学习。

**2\. 预训练深度模型**

深度模型在物品冷启动的问题中可以发挥巨大的作用，笔者在实际应用中也深深体会到了它的威力。那么它如何能够很好的处理新品的问题呢？

它可以生成质量很高的冷启动物品向量（item embedding），可以作为下游模型的物品 embedding matrix 初始权重。

步骤如下：

  1. 假设已经有一个预训练的模型 M，此模型的输入是物品元数据，输出是物品向量。
  2. 将物品的元数据输入模型 M，得到该物品的向量，这里的物品可以是所有物品，当然包括冷启动物品了。
  3. 既然有了物品向量，冷启动问题就转化为了如何使用向量的问题了，瞧，就这么解决了冷启动问题。

可见第 1 步是关键，模型 M 怎么训出来呢？

我们总是站在巨人的肩膀上，eBay 开源的一个语义 Embedding 训练框架$^1$
可以很好的完成这项任务，虽然框架已经很久没有更新了，但是其中的思想绝对值得我们去借鉴的。强烈推荐感兴趣的读者仔仔细细的研读其设计思想和代码实现，必定会有满满的收获，一旦能够将其运用在自身的业务之中，一定会让公司和个人收益无穷。

### 小结

冷启动问题一直困扰着推荐系统，是不可能完全避免的问题，冷启动一般分为：

  * 系统冷启动：推荐系统从 0 搭建
  * 用户冷启动：新用户如何推荐
  * 物品冷启动：新品怎么推出去

本篇主要聚焦后两者。

用户冷启动一般考虑采用各式各样的热门榜去做推荐，其中综合排序比较值得一试，而用户的设备、IP、GeoIP 等信息一般也会被用来处理用户冷启动问题。

物品冷启动可以通过冷热召回的方式来保证冷启动物品被召出来，比较推荐采用使用预训练（Pretrain）深度模型生成物品向量的方式来作为物品的初始向量，从而解决冷启动问题。Pretrain
的方式在深度学习领域被广泛使用，效果一般要好于从 0 训练。上文中提到的 eBay 的开源框架，其思想也是极其优秀的，非常值得研究。

下一篇，我们会迎来排序系统部分的最后一个主题——Online Learning 如何做到模型快速更新？

咱们，下篇见。

注释 1：<https://github.com/eBay/Sequence-Semantic-Embedding>

