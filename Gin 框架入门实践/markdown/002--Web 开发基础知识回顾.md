在正式了解 Gin API 之前，我们还需要了解一些相关的预备知识，这些知识对接下来的 Gin 大餐来说是非常好的开胃菜。

## HTTP 协议

HTTP 协议（HyperText Transfer Protocol）
全称为超文本传输协议，通过浏览器和服务器进行数据交互，是典型的请求（Request）/ 应答（Response）模型。浏览器作为 HTTP 客户端通过
URL 向 HTTP 服务端发送请求，服务器根据接收到的请求，向客户端发送响应信息。

HTTP 通过 URL 来传输数据和建立连接，URL 是一种特殊类型的 URI，包含了用于查找某个资源的足够的信息。HTTP
协议最大特点是无状态协议，相关请求和响应都只在这个应答期间有效。

客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头和请求数据。服务器以一个状态行开始作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头和响应数据。如下图所示：

![](https://images.gitbook.cn/WGShGt)

图 2-1 HTTP 过程

在一次完整的 HTTP 通信过程中，浏览器与服务器之间将完成下列 7 个步骤：

  1. 建立 TCP 连接

首先 Web 浏览器要通过网络与 Web 服务器建立连接，先通过三次握手的方式建立 TCP 连接，一般 Web 服务器的端口号是 80。

  2. Web 浏览器向 Web 服务器发送请求行

建立了 TCP 连接，然后 Web 浏览器就会向 Web 服务器发送请求行。请求行含有 HTTP 方法，URL 以及协议与版本号。 例如：GET
/index.html HTTP/1.1

  3. Web 浏览器发送请求头信息

浏览器发送其请求命令之后，还要以头信息的形式向 Web
服务器发送系列头信息，之后浏览器还需要发送了一个空白行来通知服务器，它已经结束了该头信息的发送，最后会给 Web 服务器发送请求数据。这四部分组成了
HTTP 的请求消息。

  4. Web 服务器响应

客户端向服务器发出请求后，服务器会响应客户端：HTTP/1.1 200 OK，响应的第一行即响应行是协议的版本号和应答状态码。

  5. Web 服务器发送响应头信息

服务器响应客户端请求时，还会响应一系列的响应头信息，如 Content-Type: text/html 等头信息。

  6. Web 服务器向浏览器发送数据

Web 服务器向浏览器发送头信息后，它会发送一个空白行来表示头信息的发送到此为结束，最后以 Content-Type
响应头信息所定义的格式来发送响应体（数据）。这四部分组成了 HTTP 的响应消息。

  7. Web 服务器关闭 TCP 连接

Web 服务器向浏览器发送了响应数据，一般都会关闭 TCP 连接。但如果保持长连接：Connection:keep-alive，则 TCP
连接在完成响应后将仍然保持打开状态。这样一来就节省了建立新连接所需的时间。

下面看看 HTTP 的请求消息与 HTTP 的响应消息的详细情况。

**HTTP Request 请求消息**

客户端发送一个 HTTP 请求到服务器的请求消息包括以下几部分：

请求行、请求头部、空行和请求数据四个部分组成。如下图 2-2 所示：

![](https://images.gitbook.cn/9zgeEs)

图 2-2 HTTP 请求消息结构

第一部分：第一行是请求行，指定请求方法，访问的资源及 HTTP 协议与版本号。

第二部分：请求头部是请求行之后空行之前的部分，头部信息往往有若干项，每一项占用一行，即一项请求头结束，就有一个换行 CRLF。

例如：HOST 将指出请求的目的地，User-Agent 指客户端设备的信息。

第三部分：空行，请求头部后面的空行是必须的。

第四部分：请求数据也叫请求体，可以包含客户提交的查询字符串等信息。而且即使第四部分的请求数据为空，前面也必须有空行。

**HTTP Response 响应消息**

Web 服务器响应一个 HTTP 请求的响应消息包括以下几部分：

响应行、响应头部、空行和响应数据四个部分组成。如下图 2-3 所示：

![](https://images.gitbook.cn/MBXzBb)

图 2-3 HTTP 响应消息结构

第一部分：第一行是响应行，响应使用的协议与版本号，响应的状态码以及状态消息。

第二部分：响应头部是响应行之后空行之前的部分，头部信息往往有若干项，每一项占用一行，即一项请求头结束，就有一个换行 CRLF。

例如：Date 指响应的时间点，Expire 指响应体在客户端缓存失效的时间点。

第三部分：空行，响应头部后面的空行是必须的。

第四部分：响应数据也叫响应体，服务器返回给客户端的文本信息。

例如，通过 curl 命令访问某个 URL 可以清楚看到 HTTP 请求消息：

    
    
    curl -v <http://www.baidu.com/index.html>
    > GET /index.html HTTP/1.1
    > Host: www.baidu.com
    > User-Agent: curl/7.64.0
    > Accept: * / *
    >
    

第一部分：请求行，第一行指定了访问方法 GET 以及 URL 和协议与版本。 第二部分：请求头部，第二行至第四行。 第三部分：空行，第五行的空行。
第四部分：请求数据为空。

而 Web 服务器在接收到请求消息后，会根据请求来响应对应的消息：

    
    
    < HTTP/1.1 200 OK
    < Date: Sat, 24 Aug 2019 04:41:21 GMT
    < Server: Apache
    < P3P: CP="OTI DSP COR IVA OUR IND COM"
    < Set-Cookie: BAIDUID=B3BD7F0C413B548568B5D217DE1F5F90:FG=1; expires=Sun, 23-Aug-20 04:41:21 GMT; max-age=31536000; path=/; domain=.baidu.com; version=1
    < Last-Modified: Wed, 08 Feb 2017 07:55:35 GMT
    < ETag: "1cd6-5480030886bc0"
    < Accept-Ranges: bytes
    < Content-Length: 7382
    < Cache-Control: max-age=1
    < Expires: Sat, 24 Aug 2019 04:41:22 GMT
    < Vary: Accept-Encoding,User-Agent
    < Connection: Keep-Alive
    < Content-Type: text/html
    <
    <!doctype html><html><head><......
    

响应体部分这里省略不写，这个请求的响应的头部信息比较多，在第二行都空白行之间都是响应的头信息，设定了缓存的失效时间，设置 Cookei 等等。

响应的状态码大致可以分为五类，分别是：

表 2-1 状态码分类

例如：

    
    
    200 OK                     // 客户端请求成功
    400 Bad Request              // 客户端请求有语法错误，不能被服务器所理解
    404 Not Found               // 请求资源不存在
    500 Internal Server Error       // 服务器发生不可预期的错误
    

HTTP 请求可以使用下列多种方法：

表 2-2 HTTP 方法

类别 | 含义  
---|---  
1XX | 信息类（Information），表示收到 Web 浏览器请求，正在进一步的处理中  
2XX | 成功类（Successful），表示用户请求被正确接收，理解和处理  
3XX | 重定向类（Redirection），表示请求没有成功，客户必须采取进一步的动作  
4XX | 客户端错误（Client Error），表示客户端提交的请求有错误  
5XX | 服务器错误（Server Error）表示服务器不能完成对请求的处理  
  
### HTTPS 协议

通过 HTTP 协议传递信息的过程是明文传递，所以基于安全的需要要对内容传输进行加密传输。而 HTTPS 正是在 HTTP 的基础上加上了 SSL
保护壳，信息的加密过程就是在 SSL 中完成的。SSL 或称 Secure Sockets Layer（安全套接层）是一种加密技术，它在 Web
服务器和允许传输私有数据的浏览器之间建立加密链接。HTTP 默认采用 80 作为通讯端口，传输采用不加密的方式，而 HTTPS 默认采用 443 端口。

为了实现 HTTPS 通信，就需要引入 SSL 证书，SSL 证书也称为 TLS 证书，是一种数字证书，实现数据的传输加密和身份核实功能。SSL
证书中包含的具体内容有证书的颁发机构、有效期、公钥、证书持有者、签名，通过第三方的校验保证了身份的合法，解决了公钥获取的安全性。SSL 证书是 CA
证书的一种，CA
机构负责签发证书、认证证书、管理已颁发证书，它制定政策和具体步骤来验证、识别用户身份，并对用户证书进行签名，以确保证书持有者的身份和公钥的拥有权。

当访问网站时在浏览器上直接显示“安全锁”和显示证书信息。通过 CA 机构签发的高级的版本 SSL
证书可以使浏览器地址栏变绿色，是最有效果的身份核实、信息加密工具。

当然也可以给自己颁发 SSL 数字证书，但自签发的数字证书默认是不受到客户端操作系统信任的，所以使用它们时在访问站点的时候就会提示不信任。

HTTPS 在传输的过程中会涉及到三个密钥：服务器端的公钥和私钥，用来进行非对称加密。客户端生成的随机密钥，用来进行对称加密。

一个完整的 HTTPS 请求实际上包含了两次 HTTP 传输，可以细分为八步：

  1. 客户端向服务器发起 HTTPS 请求，连接到服务器的 443 端口。

  2. 服务器端生成密钥对，即公钥和私钥，用来进行非对称加密，服务器端保存着私钥，不能将其泄露，公钥可以发送给任何人。

  3. 服务器将自己的公钥以及 SSL 协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书发送给客户端。

  4. 客户端收到服务器的公钥之后，会对公钥进行检查，验证服务器发送的数字证书的合法性，如果发现发现有问题，那么 HTTPS 传输就无法继续。如果客户的身份合法，则建立一个随机数然后对其进行数据签名，即客户端随机密钥，然后用服务器的公钥对客户端密钥进行非对称加密，这样客户端密钥就变成密文了，至此，HTTPS 中的第一次 HTTP 请求结束。

  5. 客户端会发起 HTTPS 中的第二个 HTTP 请求，将加密之后的客户端随机密钥发送给服务器。

  6. 服务器接收到客户端发来的密文之后，会用自己的私钥对其进行非对称解密，解密之后的明文就是客户端随机密钥，然后用客户端随机密钥对数据进行对称加密，这样数据就变成了密文。

  7. 然后服务器将加密后的密文发送给客户端。

  8. 客户端收到服务器发送来的密文，用客户端随机密钥对其进行对称解密，得到服务器发送的数据。这样 HTTPS 中的第二个 HTTP 请求结束，整个 HTTPS 传输完成。

上面简单粗略地描述了 HTTPS 实现的大致过程，如图 2-4 所示：

![](https://images.gitbook.cn/VIvnlW)

图 2-4 HTTPS 传输过程

**本节总结**

  * HTTP 请求消息的构成；
  * HTTP 响应消息的构成；
  * HTTP 协议的方法与响应状态码；
  * HTTPS 的过程。

**本节问题**

1、通过浏览器观察某个 HTTP 请求消息与响应消息的全部信息。

2、了解通过 curl 怎样发送 GET 和 POST 请求？

