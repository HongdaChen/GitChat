大型团队的敏捷转型，对于早期的敏捷实践者而言是一个全新的课题。当团队规模和系统规模提升到另一个层次，敏捷的管理实践和技术实践都需要调整和创新。华为等通信巨头的敏捷转型，对敏捷社区本身也有巨大的推动作用。

* * *

“你们现在很厉害呀，当领导了，管几百人的团队了。”郭晓笑呵呵地打趣胡凯，“我应该叫你胡经理还是胡顾问呀？”

“你就别逗了，我们心里慌得很，第一天走进那坐了一百多人的实验室，密密麻麻的全是人头和电脑，整个空间里都是风扇的嗡嗡声，我们完全都不知道该干啥。”一说起咨询项目之初的窘境，胡凯就打开了话匣子，“幸亏有
AMM 评估这个宝贝呀，我们花了一周时间做评估，一个个项目组挨个访谈，本来觉得一团乱麻的局面，‘咔咔’就理顺了。”

“我可不是跟你们开玩笑，”郭晓赞赏地点点头，“你看我这个总经理，手下还不到一百人呢，你们管的团队比我还大。团队大了，复杂度会指数上升，管理上需要更多的方法和工具，对你们是个全新的挑战。”

“我们和深圳、西安的咨询项目团队经常在互相沟通，从他们那儿学了很多管理经验。我们还在自学丰田生产方法和精益，很多想法和套路用得上。”

“你们这几个项目，是一个大台阶，”郭晓收起笑容，严肃地说道，“对华为的敏捷转型来说是一个大台阶，对我们自己的能力也是一个大台阶。ThoughtWorks
自己的管理是扁平松散的风格，没有那么多理论、套路和工具。但是未来我们也会成长，必然也会遇到规模带来的管理挑战。这个台阶上去了，不光能把华为的敏捷转型带好，而且能给
ThoughtWorks 培养一批领导者。公司的未来，可就靠你们了。”

![](https://images.gitbook.cn/d152f990-1e25-11e9-a75f-ffe749889ffe)

* * *

### AMM：敏捷成熟度模型

在项目级敏捷进入全面推行阶段的同时，华为已经启动了 **版本级敏捷的试点**
。无线产品线在西安研究所的试点、网络产品线在南京研究所的试点、以及业务软件产品线横跨深圳和南京两地的试点项目，都覆盖整个系统的大版本研发流程，时间在半年以上，团队在
100 人以上。

在这一阶段，ThoughtWorks 仍然是 **敏捷转型咨询顾问服务** 最主要的供应商。2008
年还在带领十多人的项目团队开展敏捷技术实践的这一批咨询师，到 2009
年时就需要带领上百人的大团队，进行整个系统研发范围的敏捷转型。对这些年轻的咨询师而言，迈上这一步台阶既是机遇，也是挑战。

这批缺乏大型研发团队管理经验的敏捷顾问们遇到的 **第一个难题** ，是如何快速有效地摸清一支上百人的软件研发团队的基本情况、对问题作出诊断、并提出对策。

当时这些敏捷咨询项目的一般情况是，由 3 名咨询师组成的团队需要在 1~2 周时间内完成对试点团队的初步调研和诊断，提出研发过程改进的方案，在随后的 2~3
个月的时间里指导试点团队落实改进方案。为了做好开头一两周的调研和诊断工作，ThoughtWorks 的敏捷顾问们引入了一个后来颇受争议的工具：
**敏捷成熟度模型** （Agile Maturity Model，简称 AMM）。

2006 年 6 月，ThoughtWorks 北美的咨询师 **Ross Pettit** 首次提出了 AMM 的概念1。Pettit 指出，敏捷 IT
组织的转型过程涉及需求采集、项目管理、软件开发等多个领域，过程改进的方法也多种多样，因此需要一套评估现状、设定目标、监控持续改进、度量敏捷成效的基准。为此，他发明了一套敏捷成熟度模型。

在 Pettit 起初的构想中，这套成熟度模型包含 6
个维度：需求、测试、集体代码所有权、协作、保障和治理、简单性，每个维度又由“最不敏捷”到“最敏捷”分为若干级别。可以看到，Pettit 最初的 AMM
模型很不详尽，不论是维度的划分还是级别的定义，他都用了“可能”（might）、“可以”（would）这样模糊的表述。但他的这篇文章指出了
**敏捷转型的复杂性、可拆解性和可度量性** ，这是在大规模的敏捷转型中很能令甲方和咨询师兴奋的发现。

Pettit 从一开始就意识到 AMM 这个缩写与 CMM——敏捷社区的老对头——的 **相似性**
。一方面，这层相似性可能在大型企业管理者心目中建立起一种权威感，从而增进他们对敏捷的接纳度；另一方面，这层相似性也可能会让敏捷社区产生合情合理的担忧。

Pettit 在文中极力强调，AMM 不是对敏捷的硬性规定，只是一种 **简单、灵活、基于事实的评估方法**
，帮助组织快速了解现状、定义目标。尽管如此，另一位敏捷社区的领袖 Scott Ambler
报道此事的语气仍然饱含疑虑：“敏捷成熟度模型？地狱的火焰都结冰了吗？”2 ——这个夸张的标题很能反映当时北美敏捷社区对 AMM 的态度。

ThoughtWorks 中国区的咨询师在新加坡的项目中首次接触到 AMM，并在 2007
年底华为中研的试点项目中将其引入中国3。事实证明，华为这样的大型企业确实很认同 AMM 这样一套 **可拆解、可度量、可以用雷达图形式呈现**
出来的评估机制。

后来几年中，AMM 在华为及其他大型通信企业的敏捷推进项目中被广泛应用，评估维度也被扩展到技术实践与管理实践两大类、共计 10 个维度4。首先对团队进行
AMM 评估，基本上成了 **敏捷转型项目的标配** 。同时各个转型项目又对 AMM 有不同程度的定制，例如中兴的一次 AMM 评估使用了与 Pettit
最初版本不同的 6 个维度5，阿尔卡特—朗讯的一次 AMM 评估使用了 7 个维度6。由此可见，当初敏捷社区担心的“AMM 使敏捷僵化”的情况，至少在中国
**没有发生** 。

* * *

“胡顾问，你猜今天这个持续集成是红还是绿呀？”肖鹏懒洋洋地问道，“要不要再来赌个一块钱的？”

2009 年 11 月 11 日，这天是淘宝第一次搞双十一购物节。不过，此时在华为南京研究所给网络产品线城域以太网产品部门提供咨询的
ThoughtWorks 咨询师们没心思网购。他们在这个部门搞了快一个月持续集成，CruiseControl
的界面上还没看见过一次完全成功的构建。乐观的胡凯每天都愿意出一块钱赌辛勤的华为人在顾问们下班的时间加班把持续集成搞绿，悲观的肖鹏每天都能从胡凯这里赢一块钱。

“有啥好赌的，反正还不是红。”胡凯懒洋洋地答道。

话音未落，转过一个弯角，面前出现一个全绿的 CruiseControl
界面。华为的一位项目经理远远看见两人走来，挥手跟他们打着招呼：“顾问快来看，咱们的持续集成全绿了！我们项目组今天提交了代码，也没问题！”

![](https://images.gitbook.cn/da69a290-1e25-11e9-91bd-8dbe1a8a4702)

“你看，错过了唯一一次赢我的机会了吧？”肖鹏还在跟胡凯开玩笑。

“我现在宣布，”胡凯兴奋地大声说道，“城域以太产品正式进入持续集成时代！”

* * *

### 大型团队的持续集成

按照 Martin Fowler 最初的定义， **持续集成是一种适用于单一项目团队的配置管理实践** 。这样的团队规模通常不会超过 20
人，集中在同一工作地点，且所有人工作在同一主干版本上。随着团队规模的上升，这些条件会发生巨大的变化，进而影响持续集成实践的可行性。肖鹏在 2010
年“敏捷中国”大会上的演讲7，还原了华为城域以太产品团队开展持续集成的情景。

华为的这支产品团队由 120 多名研发和测试工程师组成，研发的产品是以太网交换机的嵌入式软件。整个产品代码规模超过 1000
万行，执行完整的功能测试耗时超过 120 小时。

肖鹏在为这支团队提供咨询的过程中发现，对于小团队可能很简单的持续集成实践，
**在这种规模的研发团队中会牵涉到组织结构、软硬件环境、配置管理、构建过程、测试方法、汇报机制等多方面的因素**
。引入持续集成与其说是技术导入，毋宁说是一次组织变革，这也是为什么肖鹏的演讲被放在了大会的“组织转型”这个分会场8。

持续集成对大型团队组织产生的影响，最直观地体现在 **分支策略**
上。在典型的瀑布流程中，负责不同模块的各个项目团队只在很晚的阶段才集成彼此的工作。以华为的 IPD 流程为例，跨项目团队的集成发生在 TR4A 到 TR5
之间一段很短的时间，此时所有功能的开发理论上已经完成。但实际上集成过程会暴露大量需求、设计、编码中的错漏，因此加班赶工、乃至临时延期都是常事。

按照持续集成的原则，所有变更应该尽早、尽可能频繁地合入主干版本，并执行集成测试。但在上百人规模的团队中，如果所有人直接向主干提交代码，哪怕只是每天提交一次，也足以造成巨大的混乱，尤其是会导致测试团队长时间无法得到稳定可用的软件版本。
**如何在频繁集成与稳定可用两者之间取得平衡** ，是大型团队的分支集成策略、及其背后的团队协作方式需要解决的问题。

**肖鹏提出的解决方案是分层分级的持续集成策略** 9。他把软件的验证过程由低至高分为三级构建： **个人级** 、 **团队级** 、 **版本级**
。任何代码修改必须首先通过较低级的验证，才能被合入更上一级的分支版本、并接受更上一级的验证。同时，验证的标准也逐级提高：个人级构建只执行模块相关的单元测试；团队级构建需执行模块相关的功能测试；版本级构建更需执行全系统的重要功能测试——经过精简和优化后耗时约
10 小时。

![](https://images.gitbook.cn/e21067e0-1e25-11e9-a75f-ffe749889ffe)

采用这种策略，城域以太产品团队完整集成构建出可用版本的频率提高了 100 倍，分支代码合入主干的效率提高了 250
倍，由于消除了集成过程中的混乱，团队人均代码产量也提高了 2.2 倍10。

肖鹏和胡凯还注意到了大型团队中 **信息流动不畅**
的问题。分层分级持续集成中需要团队遵守一定的纪律，例如频繁提交代码、提交前执行本级构建、构建失败时不能提交等。在一个大型团队中，要确保数百名工程师知晓和遵守这些纪律、让团队领导了解这些纪律被执行的情况，需要更有效的信息传播机制。

胡凯开发了名为 “iAnalysis”
的持续集成信息可视化工具，用于度量并显示分层分级持续集成中的一些关键指标：提交频率、构建失败率、构建时长等。这种小工具的出现，标志着
ThoughtWorks 在尝试大规模敏捷实施的过程中，开始注意到了 **度量的重要性** 。

### 参考文献

1 [Ross Pettit.An "Agile Maturity Model?"](http://t.cn/E2JTQe4)[EB/OL].  
2 [Scott Ambler.Has Hell Frozen Over? An Agile Maturity
Model?](https://www.infoq.com/news/Agile-Maturity-Model)[EB/OL].  
3 熊节.不敢止步[M].人民邮电出版社,2014:175.  
4 未公布的内部材料《敏捷成熟度评估》  
5 未公布的内部材料《中兴网管PON团队敏捷现状和改进计划》  
6 未公布的内部材料《TDD-LTE Release 3.0敏捷成熟度报告》  
7 肖鹏在2010年“敏捷中国”的演讲《大型敏捷团队的持续交付之路》  
8
[肖鹏.我也说说敏捷中国2010大会](https://www.cnblogs.com/DesignPatterns/archive/2010/10/16/agile-2010.html)[EB/OL].  
9 ThoughtWorks中国.软件开发践行录[M].人民邮电出版社,2014:231.  
10 肖鹏未发表的讲稿《如何真正从持续集成中获益》

### 畅聊技术历史与人生

我们希望订阅课程的朋友们可以一起把酒言敏捷，分享技术世界的一切趣事，畅聊各自的技术人生。《敏捷中国史》是普通 IT
人形塑历史的故事，也是永远不会完结的技术旅程。你可以将自己的想法发表在评论区，也可以加入《敏捷中国史》交流群，小到我们一起完善这部作品，大到共同创造未来更好的
IT 世界。（入群请加 GitChat 小助手伽利略的微信，ID 为 GitChatty6，回复关键字「246」。）

![](https://images.gitbook.cn/4816dd20-3529-11e9-a761-b7bf869e8cf5)

分享上面的《敏捷中国史》阅读卡片，跟朋友一起了解中国软件开发方法的进化和一代程序员自我突破的故事。

