Yarn 既然是一个分布式资源调度框架，管理着节点上的计算资源，那它分配这些资源的时候，便会存在调度策略。

而 Yarn 的调度策略有三种：FIFO 调度、容量调度、公平调度。接下来，会依次对这几种调度器进行讲解。

### FIFO 调度器

FIFO
Scheduler（先进先出调度器），这种调度器其实已经耳熟能详了，它将所有任务放入一个队列，先进队列的先获得资源，排在后面的任务只有等待，总的原则就是先到先得。

![](https://gitee.com/QiaoLuManMan/ImageUpload/raw/master/img/20201015073243.png)

虽然这种调度策略，实现起来非常简单；但它因为只有单个队列，无法交叉运行任务、灵活性差，紧急任务无法插队，耗时长的任务拖慢耗时短的任务，对紧急任务、小任务不友好。

Yarn 在全局上，FIFO
已经不再推荐使用，但它依然被保留为三种可选的调度策略之一；而且它在调度策略为容量调度器、公平调度器时，可作为单队列内部的调度方案。

### 容量调度器

Capacity Scheduler（容量调度器）的核心思想是：提前做预算，在预算指导下分享集群资源。Yarn 默认的调度策略。

既然 FIFO
单队列对紧急、耗时短的任务不友好，使得这些任务无法立即执行，那么就划分多个队列，用于提交不同的任务，并对这些队列提前预分配资源，可以按照百分比来分配，也可以按照容量来分配。现在，假设划分两个队列
A 和 B，队列 A 用于提交大任务，因为大任务消耗资源多，所以为它预先分配集群 80% 的资源；对于小任务和紧急任务，可以提交到队列 B
中，这些任务一般占用资源较少，所以分配 20% 的资源。这样一来，小任务和紧急任务得到了保障，这是容量调度的第一个要点： **预分队列、预先分配资源**
。当然 **每个队列中使用的依然是 FIFO 调度** 。

![](https://gitee.com/QiaoLuManMan/ImageUpload/raw/master/img/20201015071041.png)

但假设很长一段时间，都没有大任务提交到 A 队列中，B 队列却很繁忙，A 队列占用的 80% 的资源一直处于空闲状态，造成了集群资源的浪费。那能够让 B
队列使用空闲的资源呢？是可以的。可以 **动态调整** 队列容量，设置队列最大资源占用，现在的配置情况是 A 为 80%，B 为 20%，但可以配置队列 B
最大可以占用集群 90% 的资源，于是队列 B 在集群空闲的时候，就可以拿到 90% 的运算资源，减少集群资源浪费。当然也可以设置为
100%，但这样的话，如果队列 A 此时提交任务，容量调度 **支持抢占** ，需要队列 B 释放资源，这部分的调度过程是有开销的。

如果存在多个队列，集群出现的空闲资源如何分配？会 **弹性分配** ，优先分配给“实际资源/预算资源”比值最低的队列。

而且容量调度可以嵌套子队列，作业分配时更加灵活。队列 A 提交大任务，队列 B 提交紧急任务和小任务，队列 B 又可以划分队列 C、D，队列 C
专门用于紧急任务，队列 D 用于小任务。

容量调度方式在企业中比较常用，它预分队列的方式可以为不同部门、不同运算任务限定不同的资源，而且因为其动态和弹性的特征，有效解决了很多的问题。

### 公平调度器

Fair
Scheduler（公平调度器），也是进行多队列的划分，但它不同于容量调度的是，公平调度不会为每个队列预先分配资源。那这些队列之间如何使用集群资源呢？多队列公平共享集群资源。

何为公平？公平当然是指，见面分一半。

![](https://gitee.com/QiaoLuManMan/ImageUpload/raw/master/img/20201018040038.png)

现在有队列 A 和队列 B，它们 **不预分配队列资源** ，于是队列 A 在开始的时候将任务 1
提交到集群中，此时发现集群并没有任务在运行，于是就占用了集群的全部资源。但过了一段时间，队列 B 中提交了任务 2，发现集群没有资源了，于是队列 B 可以
**抢占资源** ，抢占多少呢？公平起见，当然是 **见面分一半** ，给队列 A 一点调度时间，将一半资源分配给队列 B，于是队列 B 中开始运行任务
2。

公平调度，允许队列之间抢占，当然队列内部也可配置调度策略为 FIFO 或者 Fair（默认）。按照默认情况，队列 B 中任务 2 执行了一段时间之后，任务
3 被提交上来了，怎么办？见面分一半，给任务 2 一点时间进行调度，将一半资源分配给任务 3 运行。

队列内部的这种分一半的策略不是无限进行的，每个队列会设置队列内同时运行的最大任务数来避免这种拆分方式导致任务获得的资源不足的情况。

当然这不是绝对的公平，因为见面分一半是好的，但有一些队列因为提交的任务特殊，所以需要更多的资源。此时可以调节队列权重，当集群存在空闲资源的时候，按照权重来分配资源，队列在默认情况下，初始权重均为
1。

