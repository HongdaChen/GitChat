### 项目背景

某电商企业，因数据积存、分析需要，筹划搭建数据仓库；并能能够提供数据分析的访问接口，以供分析人员进行数据分析任务。

本次需要实现的是项目一期，需要完成 **数仓搭建** ，并完成 **用户复购率的分析计算** ，支持业务查询需求。

### 复购率计算

复购率是指在一段时间间隔内，多次重复购买产品的用户，占全部人数的比率。

企业需要统计各个一级品类下，品牌月单次复购率，和多次复购率。需要的数据示例如下图所示：

![](https://images.gitbook.cn/ea4831f0-f019-11ea-8755-9ff4c3d0bc34)

#### **数据描述**

企业已有的业务数据有：订单表、订单详情表、商品表、用户表、商品一级分类表、商品二级分类表、商品三级分类表、支付流水表。

#### **订单表（order_info）**

![](https://images.gitbook.cn/038d9dd0-f01a-11ea-8755-9ff4c3d0bc34)

订单表中的数据，描述了订单的一些基本属性，对于复购率计算来说，没有需要的数据。

#### **订单详情表（order_detail）**

![](https://images.gitbook.cn/17e41160-f01a-11ea-b91c-6d7fbdb6f8f7)

订单详情表描述了订单的每件商品的基本信息，有对用户和购买商品的描述，复购率计算需要用户 id 和商品 id 这两个字段数据。

#### **商品表（sku_info）**

![](https://images.gitbook.cn/2a0862b0-f01a-11ea-a374-77fb7954ed83)

商品表描述了每件商品的基本信息，需求是要计算一级品类下的品牌复购率，所以在订单详情表中的商品 id 需要关联商品表才能得到品牌 id、品类 id
这两个必要数据。

#### **用户表（user_info）**

![](https://images.gitbook.cn/3ff92550-f01a-11ea-8755-9ff4c3d0bc34)

用户表描述了注册用户的基本信息，但对品牌复购率的计算并没有帮助。

#### **商品三级分类表（base_category3）**

![](https://images.gitbook.cn/4fb80f60-f01a-11ea-8755-9ff4c3d0bc34)

商品三级分类表，描述了商品三级分类的 id 与名称，并关联到二级品类下。商品表中的品类 ID 对应的正是三级品类。可以通过 Category2_id
找到二级品类。

#### **商品二级分类表（base_category2）**

![](https://images.gitbook.cn/662024e0-f01a-11ea-889f-9de3f88b5342)

商品二级分类表，内容与商品三级分类表类似，可以通过 category1_id 找到一级品类。

#### **商品一级分类表（base_category1）**

![](https://images.gitbook.cn/7721c820-f01a-11ea-b27a-6f83744fa302)

商品一级分类表，描述了商品一级分类的 id 与名称，id 与 name 属性是复购率统计需要的。

#### **支付流水表（payment_info）**

![](https://images.gitbook.cn/8afa8030-f01a-11ea-9212-f1aa28746d87)

支付流水表记录了用户支付的流水信息，对于复购率统计并没有什么作用。

