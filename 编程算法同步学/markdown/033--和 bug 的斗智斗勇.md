### bug 的严重性

#### 小 bug 怡情，大 bug 伤身

猜数游戏中的 bug，最多是让使用者输掉一个小游戏，实在是无足轻重。但是，如果是那些和我们的生活确实相关的软件中的 bug，后果就不那么轻松了。

比如，银行计算利息的程序出了
bug，导致利息计算错误，少算了给储户的利息；通讯软件经常丢一些用户之间互发的消息等……如果发生，都会对我们的日常生活造成影响。

#### 巨大的 bug 导致灾难性结果

如果 bug 是出现在关乎国计民生的软件里，那造成的损失就不可限量了！如果航天飞机或者导弹的控制软件出了 bug，会怎么样？

事实上，这类的 bug 确实出现过：

**Case1** ：1996 年 6 月 4 日，美国阿丽亚娜 5 型运载火箭首次发射点火后，即偏离路线，在短短 30 秒后被逼引爆自毁。

![enter image description
here](https://images.gitbook.cn/e58a6a60-9bcf-11e9-9fe7-a7858c3cb1c1)

耗费 4
亿美金研发的新一代火箭，在启动半分钟后变成了一个巨大的烟花。而导致这一巨大金钱人力浪费的原因，竟然是因为一个小小的数据溢出——数据溢出哦，我们讲过的，还记得吧。

在上一代的 4 型火箭系统中，用采用 16 位的整型值作为变量（16 位的变量可以表示 [﹣32768, 32767]
区间内的值），用来表示一个火箭水平速率的测量值。因为在 4 型系统中反复验证过，火箭的水平速度不会超过 16 位的限制。

5
型火箭的开发人员简单复制了这部分程序，而没有对新火箭进行数值的验证——也不想想新型火箭是不是加速了——结果发生了致命的数值溢出，导致了整个控制系统的瘫痪，火箭不得不选择自毁。

**Case 2** ：比空耗人力财力和时间更可怕的，就是人员伤亡了。1991 年 2
月，第一次海湾战争中，一枚伊拉克发射的飞毛腿导弹准确地击中了美国在沙地阿拉伯的宰赫兰基地，当场炸死 28 个美国士兵，炸伤 100
多人，造成美军海湾战争中唯一一次伤亡超过百人的损失。

![enter image description
here](https://images.gitbook.cn/f098ebc0-9bcf-11e9-af01-8b81818e8a9b)

宰赫兰基地原本是配备了爱国者反导弹系统的，本应在空中拦截飞毛腿。但是偏偏在飞毛腿来临的时候，反导弹系统失效。

经调查发现，失效原因竟然是一个简单的软件 bug：爱国者反导弹系统的时钟寄存器设计为 24 位，因而时间的精度也只限于 24 位的精度。

然而，该系统每工作一个小时，系统内时钟就会有一个微小的毫秒级延迟。到悲剧发生时，系统已经连续工作了 100 多个小时，系统时间累计延迟 1/3 秒。

飞毛腿导弹空速为 4.2 马赫（每秒 1.5 公里），0.33 秒的时间计算误差导致了大约 600
米的距离计算误差。结果，虽然宰赫兰基地的雷达发现了飞来的飞毛腿，但因为距离的计算误差而没有能够准确定位，因此基地的反导弹装置根本就没有发射。

上述是两个巨大而知名的 bug。

除此之外，还有软件 bug 导致大规模停电，股票交易 / 长途电话业务短时崩溃，医疗设备运行错误致患者死亡……种种恶果，都直接影响到了普通人的生活。

### bug 的产生原因

既然危害如此之大，那有没有办法避免在软件中出现 bug 呢？

bug 就像疾病一样，要预防先要搞清楚病因， 我们就先来看看 bug 产生的原因。

某一个具体 bug 产生的原因不一而足，不过总体而言，bug 的出现大致可以归因于两个层面的错误：

i）实现错误

ii）设计错误

#### 实现错误

我们之前遇到的猜数字程序 bug，以及阿丽亚娜 5 型运载火箭的错误都属于这一类。

这类 bug 是说，软件（程序）在设计层面是没有问题的，但是到了具体写成代码的时候，出了错。

就好像一栋房子的设计图纸是没问题的，但是到了真的施工的时候，砌墙的师傅码错了砖。

![](https://images.gitbook.cn/0d649830-9bd0-11e9-85a0-adc1de285863)

#### 设计错误

还有一种错误，则更根本——在设计上就出了错，比如宰赫兰基地的悲剧。

阿丽亚娜 5 型火箭的 bug
是对于数据类型的容量选择不当，这是执行层面的问题。毕竟，数据类型有长度限制是常识，确定当前的这个长度界限是否够用，原本应该是编程人员的责任，步行地是他们没做。

而对于反导弹系统而言，单位工作时间会产生一定长度（虽然极其小）的时延，随着系统的工作时间增加延迟必然会累计！

作为设计者应该考虑到这个问题，并且应该在累计大到能够产生影响前就进行专门的操作对延迟进行处理。

可是，整个软件从头到尾根本就没有这样的设置。这不是简单的编码（coding）本身的问题，而是这个系统工作流程设计的问题！

这类问题的产生，往往是因为对于程序要处理的问题、要执行的任务理解不够，导致程序的业务逻辑不严密或者与实际不相符造成的。

### 避免 bug 危害的方法

目前防止 bug 产生危害的方法，大致分为三个层面。

#### 代码层（静态）

简单来说就是在代码已经编写完成后，通过对于静态程序的阅读和逻辑推演，来判断代码对于目标功能的实现程度并争取发现 bug。

对应于这一层面的具体方法叫做 **代码评审（Code Review）** 。

很多软件 /
互联网公司都规定某一个程序员编写完代码后，必须经由其他一到多个程序员评审，评审者认为可以接受后，再继续下面的工作，否则程序的开发者就要根据评审者的意见修改代码。

当然，提前发现 bug 并不是 Code Review
唯一的目的。而且，从实际效果而言，这样对着静态代码用人脑模拟计算机执行来试图发现错误，真不是件容易的事情。在现实当中，更多的 bug 是在动态代码中发现的。

#### 运行层（动态）

即通过实际运行代码，并提供给程序多种多样的输入，然后验证输出是否符合预期来确认程序的正确性和有效性。

对应于本层的方法，叫做 **软件测试（Software Test）** 。

比如我们发现猜数游戏 bug 的方法——自己心里想一个数字，然后通过运行猜数程序看它能否猜到——就是软件测试。

软件测试是一个专门的领域：

  * 测试的方法根据测试者是否了解程序逐步执行过程这一点的区别，可以分为黑盒测试和白盒测试；
  * 测试的类型有功能测试、性能测试和压力测试等；
  * 测试的执行方式可以是手动测试（人工运行待测程序，输入数据并核对输出），也可以是以程序测程序的自动化测试；
  * ……

要说起软件测试来可以单开一门课了，在此仅 **强调** ：任何一个写程序的人，都必须具备测试自己的程序的能力。任何一个程序，在编写完成之后都需要进行测试。

虽然在现实中，许多公司都会配备专职的软件测试人员——他们不负责编写程序，仅负责在开发人员写完程序之后对其进行测试，发现 bug
后再通知开发者修改，但是，任何一个编写程序的程序员都有义务保证自己写出来代码的质量。

测试人员应该是开发人员的监督者，而不是帮后者确认程序最基本功能的保姆！

#### 开发层

意即跳出程序之外，从人员配置、流程安排等人和组织管理的角度去降低 bug 发生的概率。

这方面的方法很多。

比如：测试驱动开发（Test Driven Development，TDD），就是先编写测试程序，然后再编写实际的程序。

再比如：结对编程（Pair
Programming），简单说就是两个人一起编写同一份代码，一个人写，另一个人看；写的人要不断解释自己为什么这么写，而看的人则要边看边评审，随时发现问题，并提出意见和建议。

![](https://images.gitbook.cn/26090920-9bd0-11e9-85a0-adc1de285863)

