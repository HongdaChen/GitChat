### 创建时间序列可视化

时间序列数据能够反映数据随着时间变化的一种趋势，折线图虽然也能够用于时间序列数据的可视化，但是功能过于单调，Kibana
提供了一个可视化类型：时间序列，这个时间序列类型能够加入更多的功能以及满足更多的需求。

![image-20191217203311541](https://images.gitbook.cn/2020-04-07-063051.png)

新建时间序列图，如下有时间序列，指标，等多个面板可以切换，另外还有很多自定义应用，总之功能是比折线图丰富了很多，能够更容易的表达需求。

### 趋势图分析

我们想要应用这么一个情景，查看某一个或者多个指标在一段时间范围内趋势情况如何，同样以电子商务订单索引为例，

**给定需求** ：促销追踪，追踪不同商品在一段时间内的销售情况

既然要看销售情况，那么我们使用 taxful _total_ price
字段作为统计字段，这个字段是用户下单购买的总金额数，用户购买的商品清单价格总和为实际用户下单购买的总金额数。因此下面一张图，反映了电商在一段时间范围内销售额的情况。在时间序列图创建成功后，我们在指标面板选择聚合和，字段选择
taxful _total_ price

![image-20191217213232149](https://images.gitbook.cn/2020-04-07-63052.png)

为了更好的显示，我们加上美元单位$，在指标的旁边选择“选项”，在 {{value}} 前面加上单位 \$，另外时间序列支持对图形的进一步控制

![image-20191217213837824](https://images.gitbook.cn/2020-04-07-063052.png)

根据需求调整图标类型为折线或者条，填充度等

![image-20191217214314130](https://images.gitbook.cn/2020-04-07-063053.png)

切换到面板选项，这里的选项控制着数据来源，选择哪个索引，时间字段选择哪一个，时间间隔如何设置，需不需要加过滤器，都在面板选项里面设置。如下图索引依旧选择电子商务的索引，时间字段选择
order_date 下单时间字段，时间间隔设置为 12h。也可以添加过滤器，使用 KQL 或者 Lucence 语法在面板筛选里面填写。

![image-20191217214832334](https://images.gitbook.cn/2020-04-07-063054.png)

比如筛选男性，在面板筛选里填写 **customer_gender : "MALE" **

![image-20191217215241172](https://images.gitbook.cn/2020-04-07-063055.png)

### 内容定制

切换到注释，这个功能就更丰富了，比如说设置阈值，设置提醒，将提醒在折线图中展示

**给定需求：** 设置阈值提醒

  1. 首先添加数据源

![image-20191217215530077](https://images.gitbook.cn/2020-04-07-063056.png)

  2. 索引模式选择 Kibana _sample_ data_ecommerce
  3. 时间字段选择 order_date
  4. 查询字段串，也就是阈值设置为 250 , _taxful _total_ price>=250_，这里需要注意我使用的是 KQL 语法，如果是 Lucence 语法的写法不同，所以如果这里你没有过滤成功，查看一下是使用的哪种语法。
  5. 阈值提醒图标我选的旗帜，你可以根据需求随便选一个，这里的必填字段使用来提供显示提示的数据源
  6. 行模版是显示提示格式设置，你可以尝试在前面加个单位比如说美元$

![image-20191217215908263](https://images.gitbook.cn/2020-04-07-063057.png)

  7. 加上单位后显示如下

![image-20191217220527223](https://images.gitbook.cn/2020-04-07-63058.png)

在 Discover 界面把条件填写进去，查看阈值监控注释是否给的正确。从分布上来看，总体来说是正确的。这个注释可以看到哪一单加个超过了 250。

![image-20191217220732148](https://images.gitbook.cn/2020-04-07-063058.png)

**给定需求：查看不同商品的销售情况**

结合上面流程，我们对数据根据商品类型进行筛选，下面是结果图，看起来还不算太丑

![image-20191217222326345](https://images.gitbook.cn/2020-04-07-063100.png)

以 Trousers 销售情况为例

  1. 首先加上筛选条件，在选项面板处，这里的条件我使用的是通配符方式， _*trouser*_ ,商品名称中只要包括这个字符串就行。
  2. 继续添加序列，添加多个想要的商品销售情况，加上筛选条件即可

![image-20191217222534522](https://images.gitbook.cn/2020-04-07-63101.png)

  3. 在自定义配置喜欢的颜色

![image-20191217222832931](https://images.gitbook.cn/2020-04-07-063101.png)

时间序列可视化不仅仅提供了图像的显示，指标的显示也提供了，像“指标”，“前 N 个”,"仪表盘图"，“Markdown”,"表"。

![image-20191218103417787](https://images.gitbook.cn/2020-04-07-063205.png)

### 指标

这个指标面板，可以看到图中显示了 **Trousers** 与 **Watches
**两个指标，是因为这个面板只提供了两个指标的显示，主指标与副指标。为什么显示都为 0
呢？因为在面板选择“数据”的数据时间范围格式选的是“最后值”，这样的话就能够保证指标值是最新的，也可以理解为实时指标数据，但是这个电子商务订单数据是之前插入的，随着时间的推移，没有数据插入，那么数据自然是
0，为了更好的显示，我将数据范围格式设置为“整个时间范围”。

![image-20191218104516636](https://images.gitbook.cn/2020-04-07-063206.png)

因此裤子（trousers）与手表（watches）的总销售额就显示出来了（
**这里说明一下，这个功能一般用于检测实时数据指标，但是此处为了更好的显示我选择了所有时间段**
）。不仅仅可以看所有裤子的销售情况，还可以根据词聚合，查看不同裤子的销售情况。

![image-20191218105108503](https://images.gitbook.cn/2020-04-07-63207.png)

![image-20191218105200718](https://images.gitbook.cn/2020-04-07-063208.png)

这里比较重要的，还是对于数据的筛选，条件可以看到是根据产品名称筛选，但是如何做到图表中显示的都是关于裤子这个类，聚合的结果呢？关键在与数据的筛选，在选项面板设置了
**通配符** 筛选方式。

![image-20191218105337283](https://images.gitbook.cn/2020-04-07-063209.png)

### 前 N 个

这里相当于一个横向的柱状图，可以观察到实时的或者整个时间段的不同类别的销售情况

**给定需求：查看整个时间范围内不同裤子销售情况**

![image-20191218105631810](https://images.gitbook.cn/2020-04-07-063211.png)关闭掉其他指标，并对裤子这个指标做分组，就可以轻易的看到销售情况，从上图可以看出黑裤子是热卖的一种。

![image-20191218105915171](https://images.gitbook.cn/2020-04-07-063212.png)

### 仪表盘图

将数据时间范围设置为全部时间后，将在仪表盘上显示销售情况，

![image-20191218200428857](https://images.gitbook.cn/2020-04-07-063213.png)

不仅如此你还可以在选择按照裤子的类别进行分组，并把销售额高的特别的突出。

![image-20191218201758010](https://images.gitbook.cn/2020-04-07-063215.png)

这里我是按照类别进行分组

![image-20191218201857543](https://images.gitbook.cn/2020-04-07-063216.png)

并且给定阈值，设置不同的颜色用于区分

![image-20191218201941549](https://images.gitbook.cn/2020-04-07-063217.png)

### Markdown 与表

两者都是对指标的一种文字显示，比较简单，这里简单的举例示范一下，我们根据商品名称进行分组，然后可以看到不同组在对应列中的值为多少。这也可以设置为实时反映当前销售情况的表。

![image-20191218202738722](https://images.gitbook.cn/2020-04-07-063218.png)

### 小结

本小节主要讲解了如何使用 Kibana
自带的时间序列模块对时间序列数据进行分析处理，以及在数据值显示的用法。这个模块比简单的折线图更加的灵活多样，满足更多的对时间序列分析的要求，更像一个实时动态的文档图。

