机器学习在当前是非常火热的一种技术，随着框架越来越成熟，机器学习逐渐大众化，不需要你非常精通数学领域的知识，或者阅读各种晦涩难懂的论文。现在很多算法都已经封装为成熟的
API，因此机器学习不再是算法工程师才能够掌握的技术。

普通软件开发工程师也能够掌握如何去应用机器学习。当然如果是研究型的算法，还是需要专业人士来做。软件开发工程师只需要会用和了解原理，知道如何解决当前项目中所遇到的问题就行了，如果想精进现有的算法模型，那还是有很长的一段路需要走。

话不多说，本章节就利用 ES 提供的一个机器学习工具，来对指标进行异常检测，机器学习任何人都可以用，赶紧来体验一下它的神秘之处。

### 异常

异常检测，什么是异常？如何去检测？

首先异常就是一个对比的结果，可以跟其他人比，可以跟自己比，比如说我们的天气指标，当天不同城市温度的异常，这个就是自己跟其他人的比较异常，假如说夏天来了，大部分地区都是
30 度以上，但是东北地区竟然零下，那么东北这个数据就是个异常。加入北京地区一周都是 30 度的高温，最后一天却只有 10
度，那么这天的温度就是异常，这个自己跟自己比的一个过程。

仔细考虑一下，如果是让你自己去判断，是不是很容易判断出谁“出毛病”了，但是总不能让人一直观察这些数据吧，有没有一种方法能够自动找出这个异常数据呢？

### 规则

我们平时开发的逻辑代码，都是 if else，其中逻辑代码被称作基于规则来判断，满足一定的规则就归放到某一类。但是温度异常这个需求如何用规则来判断呢？

如果用“零度”以下来判断，如果零度以上，那么就是异常，但是冬天的时候，零下不是很正常吗？难道每天都是异常？这明显不行。

那么就再加条件，如果是“夏天但是零下”就是异常。东北夏天或者俄罗斯地区，经常会出现零度以下（假设），这明显也不行。那就得继续加条件。

看明白了没？无休止地增加规则才可能逼近正确的结果。明显这种需求，规则已经无法满足。

### 无监督学习——统计

规则无法满足的，我们可以通过统计来确定，统计异常的统计方法有很多，3 sigma
模型、高斯模型、聚类等。通过统计，我们能够统计出谁是离群的个体，从而找到这个异常。算法原理这里不做过多的讨论，我们来讨论一下这些算法为什么会有效？

以聚类分析为例。我们通过一种聚类的方式把具有相同性质的聚合到一起，结果发现”红色“的旁边有个”橘黄色“的表情，这就很容易判断出它是个异常数据。这种直接统计学习，这种没有样本告诉我们哪些是异常哪些不是异常，通过统计得出的结果的算法，我们称作无监督学习。与之对应需要一个学习，需要一个参考告诉我们什么是异常的学习方式，我们称作有监督学习。

![u=3207196371,211213980&fm=26&gp=0](https://images.gitbook.cn/c1ce2d80-ac74-11ea-9793-c52d403756b9)

### 有监督学习——预测

什么是有监督学习呢？

就以小孩学习识别动物来说，小孩子需要别人告诉他，这个动物是狗，小孩子学习了四肢、有毛、耳朵等特征，记住了只有有这几种特征的就是狗，这个学习过程就是有监督学习。如果用无监督来作为对比，那么就没有人告诉小孩子这种动物是狗，但是小孩子能够把具有相同特征的动物放在一起，然后能够把“狗”和“猫”两个动物分开，但是小孩子仅仅是分开，还是不知道这是什么动物。

总结后，有学习样本的就是有监督学习，无学习样本的就是无监督学习。如果是预测明天的温度这个需求，我们该怎么做呢？

不考虑算法，如果让你人为地取预测，你是不是需要知道最近一周的温度情况，这一周基本上都是 30 度，那你是不是就会猜测明天可能是 30 度。

这有个样本例子让你去学习去做参考，所以这种方式就是监督学习。我们明白了，如果想要预测未来几天的天气温度，就必须要知道历史的数据。

### ES 异常值检测与预测

ES 有个付费的机器学习功能，可以 30 天试用，我们就用这个功能来找出天气的温度的异常值，预测未来几天的温度。

点击机器学习功能，然后开始试用，再选择索引模式，选择我们自己的天气温度指标索引。

![image-20200528215629173](https://images.gitbook.cn/f14cafa0-ac74-11ea-9611-b363141bdc4a)

**给定需求：** 查找全国地区异常的天气温度。

1\. 创建作业

![image-20200528225940233](https://images.gitbook.cn/8a3ce860-ac75-11ea-
acb2-8335c26cfba1)

2\. 选择我们的索引模板

![image-20200528225733022](https://images.gitbook.cn/822252a0-ac75-11ea-89ce-91247f7c923b)

3\. 选择单一指标

![image-20200528230013280](https://images.gitbook.cn/780cfe50-ac75-11ea-9793-c52d403756b9)

4\. 选择完整的 weather 数据

![image-20200528230042458](https://images.gitbook.cn/70663900-ac75-11ea-
acb2-8335c26cfba1)

5\. 选择均值

![image-20200528230139266](https://images.gitbook.cn/68997520-ac75-11ea-
aa64-5561411ce61e)

6\. 定义 job 名字

![image-20200528230231246](https://images.gitbook.cn/60619360-ac75-11ea-9611-b363141bdc4a)

7\. 创建作业并查看结果

![image-20200528230309843](https://images.gitbook.cn/48318f20-ac75-11ea-8951-fd44b41d4a8a)

![image-20200528230323710](https://images.gitbook.cn/4077de10-ac75-11ea-b8fa-67c56133b3a3)

8\. 异常值

![image-20200528230401329](https://images.gitbook.cn/38764e90-ac75-11ea-
bbfe-31ec274b5742)

9\. 预测

从预测结果来看，是一个常量，看起来好像不是很正确。但是还记得我们是怎么生成这些数据的吗？没错是随机生成，因此数据没有规律，所以学习不到什么东西，因此只能预测到均值。

![image-20200528230713785](https://images.gitbook.cn/2e4c60d0-ac75-11ea-9793-c52d403756b9)

### 小结

本课时简单地介绍了监督学习与非监督学习的区别，以及它们各自应用的场景，然后使用了异常值检测功能与预测功能。虽然我们很少会使用这种付费功能，但是也作为对机器学习了解的一个案例。

我们只把机器学习作为工具去应用解决遇到的需求，落地生产发现也没有那么神秘了，不是吗？如果想要在这个领域有更多的理解，建议学习 Python，因为
Python 里面有取之不尽的机器学习库。

这里由于篇幅的原因不再继续实践下去，读者自己可以多点点，测试测试，这是一个非常的有意思过程。

