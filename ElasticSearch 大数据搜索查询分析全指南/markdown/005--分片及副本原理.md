### 分片原理

分片组成一个 ES 实例，这个 ES 实例可以维护一个或者多个索引（数据库）。

前文提到过，ES 是基于 Lucene 开发的，实际上一个分片就是一个 Lucene
实例。在创建某个索引之前，需要指定分配这个索引多少个索引？多少个副本？副本就这这个分片的备胎，当分片挂掉了，它的副本就会随时准备上位，因此副本也是个分片只不过不负责主要功能。

不仅仅如此，ES
如何能够提高数据吞吐量呢？增加副本个数就是个不错的选择，比如说读写分离，读数据的时候从副本上读，写数据的时候只用主分片去写。需要注意的是，主分片的个数实在建立索引之前要确定，建立完索引之后，是不能够进行修改的，除非重新建索引。因此在建索引之前，一定要合理的配置分片个数，副本个数的话后期是可以改动的。

### 如何设置副本

启动 2 个 ES 节点，配置分片个数为 3，副本个数为
1。如下图，蓝色的代表主分片，绿色的是副本，仔细一点不难发现，分片与其副本不在同一个节点内。这是非常合理的，因为副本本来就是主分片的备胎，当主分片节点挂了，另外一个节点的副本将会充当主分片，如果它们在同一个节点内，副本将发挥不到作用。

![image-20191127175952178](https://images.gitbook.cn/2020-04-07-054133.png)

### 水平扩展原理

单个节点的容量是有限的，如果后期两个节点的容量不能够支持三个分片，那么另外启动一个节点就可以了，ES 会自动的重新规划分片，如下图：可以看到 A3
节点已经被自动的分配到 Node3 节点里面了，另外副本 B1 从 Node2 移动到 Node3 节点，B3 分片从 Node1 节点被分配到 Node2
节点。这里想一下，如果再启动一个节点呢？是的，再启动一个节点将不会对主分片起到任何作用，因为主分片不可以修改，只有三个，但是副本可以修改，能够起到扩容的作用。

![image-20191127174903741](https://images.gitbook.cn/2020-04-07-054315.png)

### 小结

本课讲述了分片以及副本的原理以及用途，为后期深入学习 ES 机制打下良好的基础，本课时你需要大概的了解 ES 是怎么做到
水平扩展的，节点与节点之间有什么联系，当新加一个节点会有什么样的事情发生。分片以及副本从来不是 ES 中才有的，凡是涉及到分布式的应用都需要，像 Kafka
集群，Hadoop 集群等。

### 答疑与交流

为了方便与作者交流与学习，GitChat 编辑团队组织了一个专栏读者交流群，添加小助手-
伽利略微信：「Linmicc」，回复关键字「363」给小助手伽利略获取入群资格。

![avatar](https://images.gitbook.cn/FrOaV_n_HIjq3OjwyqAYRX_TBOUx)

