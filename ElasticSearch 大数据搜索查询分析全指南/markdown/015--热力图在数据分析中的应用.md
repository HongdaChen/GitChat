### 热力图作用

热力图的作用就很大了，并且应用非常的广泛，我们经常把想要突出的重点用颜色重一点的来强调，其他的用浅颜色来表达，想要强调的重点就多了去了，比如说，用热力图显示金融商圈，将商家的坐标采集下来，根据坐标点进行聚类，商家比较多的地方就是金融比较繁荣的地方。下图是我百度的一张典型的热力图，这是将热力图与地图想结合，红色表达商家较多的地方，从而我们可以分析得出哪些是金融商圈。

![timg](https://images.gitbook.cn/2020-04-07-063142.jpg)

### 相关分析

热力图的表达绝不止这一种方式，数据分析应用中热力图最常用的地方是做相关性分析的时候，哪些指标相关性两者相关性比较高呢？单从数字上当然能看出来，但是如果使用热力图表达的话会更加的明显。我随便找了一张相关性分析的热力图，这张图表达相关性颜色越轻的相关性越大，颜色越黑的相关性越小，所以从这张图，我们很容易发现，自己跟自己的相关性是最高的，最低的是两个
0.2 的。这里不用关系这些指标的含义，因为我只是想告诉你热力图应用的方式，以及如何使用。

![timg](https://images.gitbook.cn/a065f390-8469-11ea-b6fa-0f8087ec57b4)

### 热力图制作

很值得兴奋的是，Kibina 也支持热力图的制作，这里也以电子商务索引为案例。

**给定需求：** 制作一个监测用户账号安全的图

如果某个客户在某一天突然购买了大量的物品，那么极有可能这个用户的账号被盗用，这个网站有责任去查看用户的购买行为是否健康，以及给出相应的提醒。

首先新建一个可视化，选择热力图。

![image-20191209215036994](https://images.gitbook.cn/2020-04-07-063145.png)

  1. 选择计数，对当天用户购买次数的统计
  2. 聚合方式选择 Date Histogram
  3. X 轴选择 _order_data_
  4. Apply 之后，可以看到下图已经简单统计了所有用户在不同时间段内购买情况，我们需要再次分桶，检测不同时间段，不同用户购买的情况

![image-20191209215614808](https://images.gitbook.cn/2020-04-07-063146.png)

  1. 首先选择添加子桶，选择 Y 轴
  2. 子聚合选择 词聚合
  3. 字段选择 _customer_id_
  4. apply 之后，可以看到下图中，框选出来的几个异常的点，这些点跟其他点相比可以看做是异常值，因此很有必要分析此时的用户下单行为是否正常，用来保护用户的账号安全。

![image-20191209215921608](https://images.gitbook.cn/2020-04-07-063147.png)

![image-20191209220235269](https://images.gitbook.cn/2020-04-07-063148.png)

那么地图的中的热力图该如何制作呢？因为前面提到了热力图也可以与地图相结合。

**给定需求：** 我想查看不同区域的销售量的情况

既然是不用区域那么肯定是用区域来做为聚合字段，计数为 Y 字段，同样新建一个可视化，选择区域地图，索引选择电子商务

![image-20191209221347218](https://images.gitbook.cn/2020-04-07-63149.png)

  1. 值选择计数
  2. 选择添加形状字段，以为我们这里选的的是区域地图，所以只能添加形状的字段，如表达“面”的字段

![image-20191209221510771](https://images.gitbook.cn/2020-04-07-063149.png)

  1. 选择词
  2. 选择 _geoip.country _iso_ code_ 字段
  3. apply 之后可以看到，颜色比较深的代表销售量较高的

![image-20191209222835790](https://images.gitbook.cn/2020-04-07-063151.png)

当然不是所有数据都可以制作区域地图，只有包含区域字段的才可以，上面的实验中 _geoip.country _iso_ code_
就是的，我们查看一下它的数据结构如何，谁也不曾想到是如此的简单

![image-20191209223212502](https://images.gitbook.cn/2020-04-07-63152.png)

如果还不仅仅满足通过区域的热力图查看销售量的情况，想要精确到某个城市或者更加细的区域，销售量的情况该如何去实现呢？

**给定需求：** 不局限某个区域，以热力图的形式查看销售量情况

首先创建一个坐标地图，索引依旧选择电子商务

![image-20191209223835278](https://images.gitbook.cn/2020-04-07-063153.png)

  1. 值选择计数
  2. 存储桶选择添加地理坐标

![image-20191209223932982](https://images.gitbook.cn/2020-04-07-063154.png)

  1. 聚合方式选择 Geohash
  2. 字段选择 geoip.location
  3. 可以看出聚合结果，颜色重的点，就是销售量比较高的地方

![image-20191209224034859](https://images.gitbook.cn/2020-04-07-63155.png)

  1. 我们还可以更改比例尺，来更详细的查看某个地区销售量情况

![image-20191209224518556](https://images.gitbook.cn/2020-04-07-063155.png)

### 小结

本小节主要讲解如何使用 Kibana 做热力图分析，不仅仅讲解了如何对简单的指标进行可视化分析，还讲解了如何结合地理位置进行可视化分析。

